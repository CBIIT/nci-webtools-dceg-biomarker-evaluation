<!DOCTYPE html>
<html>
<head>
<title>Sample Size</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<script
	src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script
	src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
<script src="/common/js/meansToRiskGlossary.js"></script>
<!-- <script src="./bc.js"></script> -->

<script src="jquery.spin.js" type="text/javascript"></script>
<link href="jquery.spin.css" rel="stylesheet" type="text/css" />


<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="/common/css/style.css" />
<link rel="stylesheet" href="sampleSize.css" />

<script>

$(function(){
        // Post json to server
        $('.post').click(function(){
          $("#output_graph").empty();
          //spinner = $("<div class='spin' data-spin />");
	  spinner = "<IMG SRC='ajax-loader.gif'>";
          $("#output_graph").append(spinner);
	  //$('.spin').spin('show');
          $.ajax({
            type: 'POST',
            // Provide correct Content-Type, so that Flask will know how to process it.
            contentType: 'application/json',
            // Encode data as JSON.
            data: JSON.stringify({
              k: $("#independent").val(),
              sens: $("#sensitivity_val").text(),
	      spec: $("#specificity_val").text(),
              prev: $("#prevalence").val(),
              N: $("#n_value").val(),
              unique_id: $("#randomnumber").text(),
	      fixed_flag:$("#fixed_flag").text() 
            }),
            // This is the type of data expected back from the server.
            dataType: 'json',
            url: '/sampleSizeRest/',
            success: function (ret) {
	      //$('.spin').spin('hide');
	      $("#output_graph").empty();
              generate_tabs($("#fixed").val(),$("#randomnumber").text());
              random_gen();
            }
          });
        });
});


function generate_tabs(iterate,randomnumber){
      var fixedvals=iterate.split(',');
      var arrayLength = fixedvals.length;
      $("#output_graph").empty();
      var tabheaders = "<ul>";
      var tabcontent="";
      var pimagename="PPVkSensSpec-";
      var cimagename="cNPVkSensSpec-";

      var fixedtype=$("#fixed_flag").text();
      console.log("Fixed flag is "+fixedtype);
      if (fixedtype === "Sensitivity"){
          pimagename="PPVkSpecSens-";
          cimagename="cNPVkSpecSens-";
      }
	
      for (var i = 0; i < arrayLength; i++) {
           console.log(fixedvals[i]);
	   tabheaders += '<li><a href="#tabs-'+(i+1)+'">'+fixedvals[i]+'</a></li>';
           //tabcontent += '<div id="tabs-'+(i+1)+'"><p>IMAGE'+fixedvals[i]+'</p></div>';
           tabcontent += '<div id="tabs-'+(i+1)+'"><p><IMG SRC="/sampleSize/tmp/'+pimagename+randomnumber+'-'+fixedvals[i]+'.png"><IMG SRC="/sampleSize/tmp/'+cimagename+randomnumber+'-'+fixedvals[i]+'.png"></p></div>';	   
    //Do something
      }    
      tabheaders += "</ul>";
      // First make the right tabs

      tabs = $("<div id='tabs'> </div>");
      $("#output_graph").append(tabs);
      $("#tabs").append(tabheaders);
      $("#tabs").append(tabcontent);
//Now execute
      $("#tabs").tabs();

};

function change_ff(){
	$("#fixed_flag").text($("#fixed_dropdown option:selected").text());
}

function lock_fixed_options(){
	var contour = $("#contour_dropdown option:selected").text();
        $("#fixed_dropdown").empty();
	if (contour === "Specificity"){
                $("#fixed_dropdown").append('<option value="specificity" disabled="disabled">Specificity</a>');
		$("#fixed_dropdown").append('<option value="sensitivity" selected>Sensitivity</a>');
	}
        if (contour === "Sensitivity"){
                $("#fixed_dropdown").append('<option value="specificity" selected>Specificity</a>');
                $("#fixed_dropdown").append('<option value="sensitivity" disabled="disabled">Sensitivity</a>');
        }
	change_ff();
}




function change_hidden(callingbox){
		if (((callingbox == "contour")) && ($("#contour_dropdown option:selected").text() == "Specificity")) {   
             	  $("#specificity_val").text($("#contour").val());
		}else if (((callingbox == "contour")) && ($("#contour_dropdown option:selected").text() == "Sensitivity")){
		  $("#sensitivity_val").text($("#contour").val());
                }else if (((callingbox == "fixed")) && ($("#fixed_dropdown option:selected").text() == "Sensitivity")){
                  $("#sensitivity_val").text($("#fixed").val());
                }else if (((callingbox == "fixed")) && ($("#fixed_dropdown option:selected").text() == "Specificity")){
                  $("#specificity_val").text($("#fixed").val());
	        }else{
		  return 0;
		}
}

function example_code(){
		$("#independent").val("0,1");
		$("#contour").val("0.8,0.9,0.95,0.995");
		$("#contour_dropdown").val("sensitivity");
		$("#fixed").val("0.7,0.8,0.9");
		$("#fixed_dropdown").val("specificity");
		$("#prevalence").val("0.001");
		$("#n_value").val("1");
		$("#fixed_flag").text("Specificity");
		change_hidden("contour");
		change_hidden("fixed");
}

function reset_code(){
                $("#independent").val("0,1");
                $("#contour").val("");
                $("#contour_dropdown").val("");
                $("#fixed").val("");
                $("#fixed_dropdown").val("");
                $("#prevalence").val("");
                $("#n_value").val("");
                $("#fixed_flag").text("");
		$("#output_graph").empty();
        //        change_hidden("contour");
        //        change_hidden("fixed");
}



function random_gen(){
          var randomno = Math.floor((Math.random() * 1000) + 1);
          $("#randomnumber").text(randomno);
}
</script>


</head>

<body onload="random_gen()">
	<div style='width: 1100px; margin-left: auto; margin-right: auto;'>
		<!-- blockcontent was here -->
		<div id="wrapper">
			<div id="logos">
				<div id="left">
					<a href="http://www.cancer.gov" target="_blank"><img
						src="/common/images/nci.jpg" width="286" height="40" border="0"
						alt="National Cancer Institute" title="National Cancer Institute" /></a>
				</div>
				<div id="right">
					<a href="http://www.cancer.gov" target="_blank"><img
						src="/common/images/nih.jpg" width="322" height="40" border="0"
						alt="at the National Institutes of Health"
						title="at the National Institutes of Health" /></a>
				</div>
			</div>
		</div>
		<br>

		<div id="banners">
			<div id="left">
				<img src="/common/images/DCEG-BB-HREB.png"
					alt="Banner for NCI Division of Cancer Epidemiology, Genetics Biostatistics Branch, Hormonal and Reproductive Epidemiology Branch "
					height="43" />
			</div>
		</div>

		<div id='main'>
			<br>
			<h2 class="title" align="center">Sample Size</h2>
			<div id="helpGlossaryLinks">
				<a href="#"
					onclick="openHelpWindow('/common/html/meansToRiskGlossary.html')">Glossary</a>
			</div>
			<br>
			<! -- PLACE TOOL DESCRIPTION HERE -->
			<div style='clear: left; padding-top: 10px;'>
<table>
				<tr>
					<td class='label' align="right"><label for="independent_dropdown">Independent Variable</label></td>
					<td><select id="independent_dropdown"
						name="independent_dropdown" width="100%">
							<option value="k" selected>k</option>

					</select></td>
					<td><label for="independent"> <input type="text"
							size="30" id="independent" pattern="([0-9,. \-])+"
							title="An array of floating point numbers seperated by commas."
							title="An array of floating point numbers seperated by commas"
							value="0,1" required>
					</label></td>
				</tr>
				<tr>
					<td class='label' align="right"><label for="contour_dropdown">Contour</label></td>
					<td><select id="contour_dropdown" name="contour_dropdown" onchange="lock_fixed_options();">
							<option value="" selected></option>
							<option value="specificity">Specificity</option>
							<option value="sensitivity">Sensitivity</option>
					</select></td>
					<td><label for="contour"> <input type="text" size="30"
							id="contour" pattern="([0-9,. \-])+"
							title="An array of floating point numbers seperated by commas."
							title="An array of floating point numbers seperated by commas"
							onkeyup="change_hidden('contour')" required>
					</label></td>
				</tr>
				<tr>
					<td class='label'><label for="fixed_dropdown">Fixed Values</label></td>
					<td><select id="fixed_dropdown" name="fixed_dropdown"
						id='fixed_dropdown'>
							<option value="" selected></option>
						        <option value="specificity" disabled="disabled">Specificity</option>
                                                        <option value="sensitivity" disabled="disabled">Sensitivity</option>

					</select></td>
					<td><label for="fixed"> <input type="text" size="30"
							id="fixed" pattern="([0-9,. \-])+"
							title="An array of floating point numbers seperated by commas"
							onkeyup="change_hidden('fixed')" required>
					</label></td>
				</tr>
								<tr>
					<td class='label'><label for="prevalence">Prevalence</label></td>
					<td><label for="prevalence"> <input type="text" size="10"
							id="prevalence" value="0.001"
							title="An array of floating point numbers seperated by commas"
							required>
					</label></td>
				</tr>
								<tr>
					<td class='label'><label for="n_value">N</label></td>
					<td><label for="fixed"> <input type="text" size="10"
							id="n_value" value="1" pattern="([0-9,. \-])+"
							title="An array of floating point numbers seperated by commas"
							required>
					</label></td>
				</tr>
				<tr><td></td><td></td><td></td></tr>
   				<tr>
					<td class="label spacer">
                                		<button class="post">Calculate</button>
					</td>
					<td class="spacer">
 						<button id="reset_button" onclick="reset_code();">Reset</button>

</td>
					<td class="spacer">
					 <A HREF="javascript:example_code()">Example</a>
					</td>
				</tr>

			</table>
			<br />
				<div id="specificity_val" style="display:none"></div>
				<div id="sensitivity_val"style="display:none"></div>
                                <div id="fixed_flag"style="display:none"></div>
			      	<div id="randomnumber"style="display:none"></div>
        <br /><br />


			</div>
			</div>
				<div id="output_graph">
                                </div>
	</div>
	<!-- main -->

	<div id="portal-footer">
		<div class="footerLinks">
			<a href="http://www.cancer.gov/" title="Home">Home</a>&nbsp;&nbsp;|&nbsp;&nbsp;
			<a href="mailto:NCIMeansToRiskWebAdmin@mail.nih.gov" title="Support">Support</a>&nbsp;&nbsp;|&nbsp;&nbsp;
			<a href="http://www.cancer.gov/global/web/policies" title="Policies">Policies</a>&nbsp;&nbsp;|&nbsp;&nbsp;
			<a href="http://www.cancer.gov/global/web/policies/accessibility"
				title="Accessibility">Accessibility</a>&nbsp;&nbsp;|&nbsp;&nbsp; <a
				href="http://cancer.gov/global/viewing-files" target="_blank"
				title="Viewing Files">Viewing Files</a>&nbsp;&nbsp;|&nbsp;&nbsp; <a
				href="http://www.cancer.gov/global/web/policies/foia" title="FOIA">FOIA</a><br />
			<br /> <a href="http://www.dhhs.gov/">Department of Health and
				Human Services</a>&nbsp;&nbsp;|&nbsp;&nbsp; <a
				href="http://www.nih.gov/">National Institutes of Health</a>&nbsp;&nbsp;|&nbsp;&nbsp;
			<a href="http://www.cancer.gov/">National Cancer Institute</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a
				href="http://www.usa.gov/">USA.gov</a>
		</div>
		<br /> <br /> NIH...Turning Discovery Into Health<sup>&reg;</sup>
	</div>
</body>
</html>
